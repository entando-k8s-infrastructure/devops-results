<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Frame.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Entando Core: Engine</a> &gt; <a href="index.source.html" class="el_package">com.agiletec.aps.system.services.pagemodel</a> &gt; <span class="el_source">Frame.java</span></div><h1>Frame.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2015-Present Entando Inc. (http://www.entando.com) All rights reserved.
 *
 * This library is free software; you can redistribute it and/or modify it under
 * the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation; either version 2.1 of the License, or (at your option)
 * any later version.
 *
 * This library is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 */

package com.agiletec.aps.system.services.pagemodel;

import com.agiletec.aps.system.services.page.Widget;
import com.agiletec.aps.util.ApsProperties;
import java.io.Serializable;
import java.util.Objects;
import java.util.Properties;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlTransient;
import javax.xml.bind.annotation.XmlType;
import org.apache.commons.lang3.builder.ToStringBuilder;
import org.entando.entando.aps.system.services.widgettype.IWidgetTypeManager;
import org.entando.entando.aps.system.services.widgettype.WidgetType;

/**
 * Representation of a frame of page model
 */
@XmlRootElement(name = &quot;frame&quot;)
@XmlType(propOrder = {&quot;pos&quot;, &quot;description&quot;, &quot;mainFrame&quot;, &quot;jaxbDefaultWidget&quot;, &quot;sketch&quot;})
<span class="fc" id="L35">public class Frame implements Serializable {</span>

    private int pos;
    private String description;
    private boolean mainFrame;
    private Widget defaultWidget;

    private JAXBDefaultWidget jaxbDefaultWidget;
    private FrameSketch sketch;

    private transient IWidgetTypeManager widgetTypeManager;

    @XmlElement(name = &quot;code&quot;, required = true)
    public int getPos() {
<span class="fc" id="L49">        return pos;</span>
    }

    public void setPos(int pos) {
<span class="fc" id="L53">        this.pos = pos;</span>
<span class="fc" id="L54">    }</span>

    @XmlElement(name = &quot;description&quot;, required = true)
    public String getDescription() {
<span class="fc" id="L58">        return description;</span>
    }

    public void setDescription(String description) {
<span class="fc" id="L62">        this.description = description;</span>
<span class="fc" id="L63">    }</span>

    @XmlElement(name = &quot;mainFrame&quot;, required = false)
    public boolean isMainFrame() {
<span class="fc" id="L67">        return mainFrame;</span>
    }

    public void setMainFrame(boolean mainFrame) {
<span class="fc" id="L71">        this.mainFrame = mainFrame;</span>
<span class="fc" id="L72">    }</span>

    @XmlTransient
    public Widget getDefaultWidget() {
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">        if (shouldUseDefaultWidget()) {</span>
<span class="nc" id="L77">            defaultWidget = jaxbDefaultWidget.createDefaultWidget(widgetTypeManager);</span>
        }

<span class="fc" id="L80">        jaxbDefaultWidget = null;</span>
<span class="fc" id="L81">        widgetTypeManager = null;</span>
<span class="fc" id="L82">        return defaultWidget;</span>
    }

    public void setDefaultWidget(Widget defaultWidget) {
<span class="fc" id="L86">        this.defaultWidget = defaultWidget;</span>
<span class="fc" id="L87">    }</span>

    private boolean shouldUseDefaultWidget() {
<span class="pc bpc" id="L90" title="3 of 6 branches missed.">        return (defaultWidget == null) &amp;&amp;</span>
                (jaxbDefaultWidget != null) &amp;&amp;
                (widgetTypeManager != null);
    }

    @XmlElement(name = &quot;defaultWidget&quot;, required = false)
    public JAXBDefaultWidget getJaxbDefaultWidget() {
<span class="fc bfc" id="L97" title="All 2 branches covered.">        if (needToCreateNewJaxbDefaultWidget()) {</span>
<span class="fc" id="L98">            jaxbDefaultWidget = new JAXBDefaultWidget(defaultWidget);</span>
        }
<span class="fc" id="L100">        return jaxbDefaultWidget;</span>
    }

    public void setJaxbDefaultWidget(JAXBDefaultWidget jaxbDefaultWidget) {
<span class="nc" id="L104">        this.jaxbDefaultWidget = jaxbDefaultWidget;</span>
<span class="nc" id="L105">    }</span>

    private boolean needToCreateNewJaxbDefaultWidget() {
<span class="pc bpc" id="L108" title="1 of 4 branches missed.">        return (jaxbDefaultWidget == null) &amp;&amp; (defaultWidget != null);</span>
    }

    public void setWidgetTypeManager(IWidgetTypeManager widgetTypeManager) {
<span class="nc" id="L112">        this.widgetTypeManager = widgetTypeManager;</span>
<span class="nc" id="L113">    }</span>

    @XmlElement(name = &quot;sketch&quot;, required = false)
    public FrameSketch getSketch() {
<span class="fc" id="L117">        return sketch;</span>
    }

    public void setSketch(FrameSketch sketch) {
<span class="fc" id="L121">        this.sketch = sketch;</span>
<span class="fc" id="L122">    }</span>

    @Override
    public Frame clone() {
<span class="nc" id="L126">        Frame clone = new Frame();</span>
<span class="nc" id="L127">        clone.setDefaultWidget(this.getDefaultWidget());</span>
<span class="nc" id="L128">        clone.setDescription(this.getDescription());</span>
<span class="nc" id="L129">        clone.setMainFrame(this.isMainFrame());</span>
<span class="nc" id="L130">        clone.setPos(this.getPos());</span>
<span class="nc" id="L131">        clone.setSketch(this.getSketch());</span>
<span class="nc" id="L132">        return clone;</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">        if (this == o) {</span>
<span class="nc" id="L138">            return true;</span>
        }
<span class="pc bpc" id="L140" title="2 of 4 branches missed.">        if (o == null || getClass() != o.getClass()) {</span>
<span class="nc" id="L141">            return false;</span>
        }
<span class="fc" id="L143">        Frame frame = (Frame) o;</span>
<span class="pc bpc" id="L144" title="2 of 4 branches missed.">        return pos == frame.pos &amp;&amp;</span>
                mainFrame == frame.mainFrame &amp;&amp;
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">                Objects.equals(description, frame.description) &amp;&amp;</span>
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">                Objects.equals(defaultWidget, frame.defaultWidget) &amp;&amp;</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">                Objects.equals(jaxbDefaultWidget, frame.jaxbDefaultWidget) &amp;&amp;</span>
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">                Objects.equals(sketch, frame.sketch) &amp;&amp;</span>
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">                Objects.equals(widgetTypeManager, frame.widgetTypeManager);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L155">        return Objects.hash(pos, description, mainFrame, defaultWidget, jaxbDefaultWidget, sketch, widgetTypeManager);</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L160">        return new ToStringBuilder(this)</span>
<span class="nc" id="L161">                .append(&quot;pos&quot;, pos)</span>
<span class="nc" id="L162">                .append(&quot;description&quot;, description)</span>
<span class="nc" id="L163">                .append(&quot;mainFrame&quot;, mainFrame)</span>
<span class="nc" id="L164">                .append(&quot;defaultWidget&quot;, defaultWidget)</span>
<span class="nc" id="L165">                .append(&quot;jaxbDefaultWidget&quot;, jaxbDefaultWidget)</span>
<span class="nc" id="L166">                .append(&quot;sketch&quot;, sketch)</span>
<span class="nc" id="L167">                .append(&quot;widgetTypeManager&quot;, widgetTypeManager)</span>
<span class="nc" id="L168">                .toString();</span>
    }

    @XmlRootElement(name = &quot;defaultWidget&quot;)
    @XmlType(propOrder = {&quot;code&quot;, &quot;properties&quot;})
    public static class JAXBDefaultWidget implements Serializable {

        private String code;
        private Properties properties;

<span class="nc" id="L178">        public JAXBDefaultWidget() {</span>
<span class="nc" id="L179">        }</span>

<span class="fc" id="L181">        public JAXBDefaultWidget(Widget defaultWidget) {</span>
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">            if (defaultWidget == null) {</span>
<span class="nc" id="L183">                return;</span>
            }
<span class="fc" id="L185">            WidgetType type = defaultWidget.getType();</span>
<span class="fc" id="L186">            code = type.getCode();</span>
<span class="fc" id="L187">            properties = defaultWidget.getConfig();</span>
<span class="fc" id="L188">        }</span>

        public Widget createDefaultWidget(IWidgetTypeManager widgetTypeManager) {
<span class="nc" id="L191">            WidgetType type = widgetTypeManager.getWidgetType(code);</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">            if (type == null) {</span>
<span class="nc" id="L193">                return null;</span>
            }
<span class="nc" id="L195">            Widget widget = new Widget();</span>
<span class="nc" id="L196">            widget.setType(type);</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">            if (properties != null) {</span>
<span class="nc" id="L198">                ApsProperties apsProperties = new ApsProperties(properties);</span>
<span class="nc" id="L199">                widget.setConfig(apsProperties);</span>
            }
<span class="nc" id="L201">            return widget;</span>
        }

        @XmlElement(name = &quot;code&quot;, required = true)
        public String getCode() {
<span class="fc" id="L206">            return code;</span>
        }

        public void setCode(String code) {
<span class="nc" id="L210">            this.code = code;</span>
<span class="nc" id="L211">        }</span>

        @XmlElement(name = &quot;configuration&quot;, required = false)
        public Properties getProperties() {
<span class="fc" id="L215">            return properties;</span>
        }

        public void setProperties(Properties properties) {
<span class="nc" id="L219">            this.properties = properties;</span>
<span class="nc" id="L220">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FieldSearchFilter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Entando Core: Engine</a> &gt; <a href="index.source.html" class="el_package">com.agiletec.aps.system.common</a> &gt; <span class="el_source">FieldSearchFilter.java</span></div><h1>FieldSearchFilter.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2015-Present Entando Inc. (http://www.entando.com) All rights reserved.
 *
 * This library is free software; you can redistribute it and/or modify it under
 * the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation; either version 2.1 of the License, or (at your option)
 * any later version.
 *
 * This library is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 */

package com.agiletec.aps.system.common;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

/**
 * This class implements a filter to search among database field.
 *
 * @author E.Santoboni
 */
public class FieldSearchFilter&lt;T&gt; implements Serializable {

<span class="nc" id="L29">    public static final String ASC_ORDER = Order.ASC.toString();</span>
<span class="nc" id="L30">    public static final String DESC_ORDER = Order.DESC.toString();</span>
    private String key;
    private T value;
    private Order order;
    private T start;
    private T end;
    private boolean likeOption;
    private LikeOptionType likeOptionType;
    private boolean nullOption;
    private boolean notOption;
    private List&lt;T&gt; allowedValues;
    private Integer startDateDelay;
    private Integer endDateDelay;
    private Integer valueDateDelay;
    private Integer limit;
    private Integer offset;

<span class="nc" id="L47">    protected FieldSearchFilter() {</span>
<span class="nc" id="L48">    }</span>

    /**
     * Filter constructor for paginated results
     */
<span class="nc" id="L53">    public FieldSearchFilter(Integer limit, Integer offset) {</span>
<span class="nc" id="L54">        this.setLimit(limit);</span>
<span class="nc" id="L55">        this.setOffset(offset);</span>
<span class="nc" id="L56">    }</span>

    /**
     * Filter constructor. This constructor is used when checking the presence of a value contained either in the metadata.
     *
     * @param key The key of the filtering element; it may be the ID of metadata.
     */
<span class="nc" id="L63">    public FieldSearchFilter(String key) {</span>
<span class="nc" id="L64">        this.setKey(key);</span>
<span class="nc" id="L65">    }</span>

    /**
     * Filter constructor. This constructor must be used to filter the attribute values or entity metadata looking for a specific value.
     *
     * @param key The key of the filtering element; it may be the ID of metadata.
     * @param value The value to look for.
     * @param useLikeOption When true the database search will be performed using the &quot;LIKE&quot; clause. This option can be used to filter by
     * the value of a string metadata. It can be used only with string and with not null values.
     */
    public FieldSearchFilter(String key, T value, boolean useLikeOption) {
<span class="nc" id="L76">        this(key);</span>
<span class="nc bnc" id="L77" title="All 6 branches missed.">        if (null != value &amp;&amp; value instanceof Collection &amp;&amp; ((Collection) value).size() &gt; 0) {</span>
<span class="nc" id="L78">            List&lt;T&gt; allowedValues = new ArrayList&lt;T&gt;();</span>
<span class="nc" id="L79">            allowedValues.addAll((Collection) value);</span>
<span class="nc" id="L80">            this.setAllowedValues(allowedValues);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">            if (allowedValues.get(0) instanceof String) {</span>
<span class="nc" id="L82">                this.setLikeOption(useLikeOption);</span>
            }
<span class="nc" id="L84">        } else {</span>
<span class="nc" id="L85">            this.setValue(value);</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">            if (value instanceof String) {</span>
<span class="nc" id="L87">                this.setLikeOption(useLikeOption);</span>
            }
        }
<span class="nc" id="L90">    }</span>

    public FieldSearchFilter(String key, T value, boolean useLikeOption, LikeOptionType likeOptionType) {
<span class="nc" id="L93">        this(key, value, useLikeOption);</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (this.isLikeOption()) {</span>
<span class="nc" id="L95">            this.setLikeOptionType(likeOptionType);</span>
        }
<span class="nc" id="L97">    }</span>

    /**
     * Filter constructor. This constructor is used when filtering by a range of values.
     *
     * @param key The key of the filtering element; it may be the ID of metadata.
     * @param start The starting value of the interval. It can be an object of type &quot;String&quot;, &quot;Date&quot;, &quot;BigDecimal&quot;, &quot;Boolean&quot; o null.
     * @param end The ending value of the interval. It can be an object of type &quot;String&quot;, &quot;Date&quot;, &quot;BigDecimal&quot;, &quot;Boolean&quot; o null.
     */
    public FieldSearchFilter(String key, T start, T end) {
<span class="nc" id="L107">        this(key);</span>
<span class="nc bnc" id="L108" title="All 6 branches missed.">        if (start != null &amp;&amp; end != null &amp;&amp; !start.getClass().equals(end.getClass())) {</span>
<span class="nc" id="L109">            throw new RuntimeException(&quot;Error: 'start' and 'end' types have to be equals&quot;);</span>
        }
<span class="nc" id="L111">        this.setStart(start);</span>
<span class="nc" id="L112">        this.setEnd(end);</span>
<span class="nc" id="L113">    }</span>

    /**
     * Filter constructor. This constructor is used when filtering by a collection of allowed values.
     *
     * @param key key The key of the filtering element; it may be the ID of metadata.
     * @param allowedValues The allowed values to look for. If null, the filter checks if the metadata has been valued.
     * @param useLikeOption When true the database search will be performed using the &quot;LIKE&quot; clause. This option can be used to filter by
     * the value of a string metadata. It can be used only with string and with allowed values not null.
     */
    public FieldSearchFilter(String key, List&lt;T&gt; allowedValues, boolean useLikeOption) {
<span class="nc" id="L124">        this(key);</span>
<span class="nc" id="L125">        this.setAllowedValues(allowedValues);</span>
<span class="nc bnc" id="L126" title="All 6 branches missed.">        if (null != allowedValues &amp;&amp; allowedValues.size() &gt; 0 &amp;&amp; (allowedValues.get(0) instanceof String)) {</span>
<span class="nc" id="L127">            this.setLikeOption(useLikeOption);</span>
        }
<span class="nc" id="L129">    }</span>

    public FieldSearchFilter(String key, List&lt;T&gt; allowedValues, boolean useLikeOption, LikeOptionType likeOptionType) {
<span class="nc" id="L132">        this(key, allowedValues, useLikeOption);</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (this.isLikeOption()) {</span>
<span class="nc" id="L134">            this.setLikeOptionType(likeOptionType);</span>
        }
<span class="nc" id="L136">    }</span>

    /**
     * Return the key of the filter object.
     *
     * @return The key of the filter object.
     */
    public String getKey() {
<span class="nc" id="L144">        return key;</span>
    }

    public void setKey(String key) {
<span class="nc bnc" id="L148" title="All 4 branches missed.">        if (null == key || key.trim().length() == 0) {</span>
<span class="nc" id="L149">            throw new RuntimeException(&quot;Error: Key required&quot;);</span>
        }
<span class="nc" id="L151">        this.key = key;</span>
<span class="nc" id="L152">    }</span>

    /**
     * Return the value of the key of the entity to look for.
     *
     * @return The value to look for.
     */
    public T getValue() {
<span class="nc" id="L160">        return value;</span>
    }

    protected void setValue(T value) {
<span class="nc" id="L164">        this.value = value;</span>
<span class="nc" id="L165">    }</span>

    /**
     * Return the starting value of the interval. It can be an object of type &quot;String&quot;, &quot;Date&quot;, &quot;BigDecimal&quot;, &quot;Boolean&quot; o null.
     *
     * @return The starting value of the interval.
     */
    public T getStart() {
<span class="nc" id="L173">        return start;</span>
    }

    protected void setStart(T start) {
<span class="nc" id="L177">        this.start = start;</span>
<span class="nc" id="L178">    }</span>

    /**
     * Return the ending date of the interval. It can be an object of type &quot;String&quot;, &quot;Date&quot;, &quot;BigDecimal&quot;, &quot;Boolean&quot; o null.
     *
     * @return L'end dell'intervallo;
     */
    public T getEnd() {
<span class="nc" id="L186">        return end;</span>
    }

    protected void setEnd(T end) {
<span class="nc" id="L190">        this.end = end;</span>
<span class="nc" id="L191">    }</span>

    /**
     * Return the order to use to sort results found when the filter is applied.
     *
     * @return The order used to sort results found applying the filter.
     */
    public Order getOrder() {
<span class="nc" id="L199">        return this.order;</span>
    }

    /**
     * Set up the order to use to sort results found when the filter is applied. It can assume the values &quot;ASC&quot; or &quot;DESC&quot; and depends on the
     * field specified in the filter.
     *
     * @param order The order used to sort results found applying the filter.
     */
    public void setOrder(String order) {
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (null == order) {</span>
<span class="nc" id="L210">            return;</span>
<span class="nc bnc" id="L211" title="All 4 branches missed.">        } else if (!(order.equals(ASC_ORDER) || order.equals(DESC_ORDER))) {</span>
<span class="nc" id="L212">            throw new RuntimeException(</span>
                    &quot;Error: the 'order' clause cannot be null and must be comparable using the constants ASC_ORDER or DESC_ORDER&quot;);
        }
<span class="nc" id="L215">        this.order = Enum.valueOf(Order.class, order);</span>
<span class="nc" id="L216">    }</span>

    /**
     * Set up the order to use to sort results found when the filter is applied.
     *
     * @param order The order used to sort results found applying the filter.
     */
    public void setOrder(Order order) {
<span class="nc" id="L224">        this.order = order;</span>
<span class="nc" id="L225">    }</span>

    /**
     * Check whether the string must be performed using the &quot;LIKE&quot; clause or not. This option can be used to filter by a specific value in
     * this attributes containing text strings.
     *
     * @return True if the search process can have the &quot;LIKE&quot; clause enabled, false otherwise.
     */
    public boolean isLikeOption() {
<span class="nc" id="L234">        return likeOption;</span>
    }

    protected void setLikeOption(boolean likeOption) {
<span class="nc bnc" id="L238" title="All 6 branches missed.">        if (likeOption &amp;&amp; ((null == this.getValue() || !(this.getValue() instanceof String))</span>
<span class="nc bnc" id="L239" title="All 4 branches missed.">                &amp;&amp; (null == this.getAllowedValues() || this.getAllowedValues().isEmpty() || !(this.getAllowedValues()</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">                .get(0) instanceof String)))) {</span>
<span class="nc" id="L241">            throw new RuntimeException(&quot;Error: The 'like' clause cannot be applied on a null value or on a not string type&quot;);</span>
        }
<span class="nc" id="L243">        this.likeOption = likeOption;</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (likeOption) {</span>
<span class="nc" id="L245">            this.setLikeOptionType(LikeOptionType.COMPLETE);</span>
        }
<span class="nc" id="L247">    }</span>

    public LikeOptionType getLikeOptionType() {
<span class="nc" id="L250">        return likeOptionType;</span>
    }

    protected void setLikeOptionType(LikeOptionType likeOptionType) {
<span class="nc bnc" id="L254" title="All 2 branches missed.">        if (!this.isLikeOption()) {</span>
<span class="nc" id="L255">            throw new RuntimeException(&quot;Error: The 'like type' clause cannot be applied on a false value of 'like option'&quot;);</span>
        }
<span class="nc" id="L257">        this.likeOptionType = likeOptionType;</span>
<span class="nc" id="L258">    }</span>

    public boolean isNullOption() {
<span class="nc" id="L261">        return nullOption;</span>
    }

    public void setNullOption(boolean nullOption) {
<span class="nc bnc" id="L265" title="All 8 branches missed.">        if (nullOption &amp;&amp; (null != this.getValue() || null != this.getAllowedValues() || null != this.getStart() || null != this</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                .getEnd())) {</span>
<span class="nc" id="L267">            throw new RuntimeException(&quot;Error: the NULL clause may be used only in conjunction with null metadata fields&quot;);</span>
        }
<span class="nc" id="L269">        this.nullOption = nullOption;</span>
<span class="nc" id="L270">    }</span>

    public boolean isNotOption() {
<span class="nc" id="L273">        return notOption;</span>
    }

    public void setNotOption(boolean notOption) {
<span class="nc bnc" id="L277" title="All 10 branches missed.">        if (notOption &amp;&amp; (null == this.getValue() || null != this.getAllowedValues() || null != this.getStart() || null != this.getEnd())) {</span>
<span class="nc" id="L278">            throw new RuntimeException(&quot;Error: the NOT clause must have a value&quot;);</span>
        }
<span class="nc" id="L280">        this.notOption = notOption;</span>
<span class="nc" id="L281">    }</span>

    public List&lt;T&gt; getAllowedValues() {
<span class="nc" id="L284">        return allowedValues;</span>
    }

    protected void setAllowedValues(List&lt;T&gt; allowedValues) {
<span class="nc" id="L288">        this.allowedValues = allowedValues;</span>
<span class="nc" id="L289">    }</span>

    public Integer getStartDateDelay() {
<span class="nc" id="L292">        return startDateDelay;</span>
    }

    public void setStartDateDelay(Integer startDateDelay) {
<span class="nc" id="L296">        this.startDateDelay = startDateDelay;</span>
<span class="nc" id="L297">    }</span>

    public Integer getEndDateDelay() {
<span class="nc" id="L300">        return endDateDelay;</span>
    }

    public void setEndDateDelay(Integer endDateDelay) {
<span class="nc" id="L304">        this.endDateDelay = endDateDelay;</span>
<span class="nc" id="L305">    }</span>

    public Integer getValueDateDelay() {
<span class="nc" id="L308">        return valueDateDelay;</span>
    }

    public void setValueDateDelay(Integer valueDateDelay) {
<span class="nc" id="L312">        this.valueDateDelay = valueDateDelay;</span>
<span class="nc" id="L313">    }</span>

    public Integer getLimit() {
<span class="nc" id="L316">        return limit;</span>
    }

    public void setLimit(Integer limit) {
<span class="nc" id="L320">        this.limit = limit;</span>
<span class="nc" id="L321">    }</span>

    public Integer getOffset() {
<span class="nc" id="L324">        return offset;</span>
    }

    public void setOffset(Integer offset) {
<span class="nc" id="L328">        this.offset = offset;</span>
<span class="nc" id="L329">    }</span>

    @Override
    public String toString() {
<span class="nc" id="L333">        return &quot;FieldSearchFilter [key=&quot; + key + &quot;, value=&quot; + value + &quot;, order=&quot; + order + &quot;, start=&quot; + start + &quot;, end=&quot; + end</span>
                + &quot;, likeOption=&quot; + likeOption + &quot;, likeOptionType=&quot; + likeOptionType + &quot;, nullOption=&quot; +
                nullOption + &quot;, allowedValues=&quot; + allowedValues + &quot;, startDateDelay=&quot; + startDateDelay + &quot;, endDateDelay=&quot; + endDateDelay
                + &quot;, valueDateDelay=&quot; + valueDateDelay + &quot;, limit=&quot; + limit + &quot;, offset=&quot; +
                offset + &quot;, notOption=&quot; + notOption + &quot;]&quot;;
    }

<span class="nc" id="L340">    public enum Order {</span>
<span class="nc" id="L341">        ASC,</span>
<span class="nc" id="L342">        DESC</span>
    }

<span class="nc" id="L345">    public enum LikeOptionType {</span>
<span class="nc" id="L346">        COMPLETE,</span>
<span class="nc" id="L347">        RIGHT,</span>
<span class="nc" id="L348">        LEFT</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>
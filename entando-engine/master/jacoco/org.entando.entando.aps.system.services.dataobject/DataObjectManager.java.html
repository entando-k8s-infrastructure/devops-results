<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataObjectManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Entando Core: Engine</a> &gt; <a href="index.source.html" class="el_package">org.entando.entando.aps.system.services.dataobject</a> &gt; <span class="el_source">DataObjectManager.java</span></div><h1>DataObjectManager.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2015-Present Entando Inc. (http://www.entando.com) All rights reserved.
 *
 * This library is free software; you can redistribute it and/or modify it under
 * the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation; either version 2.1 of the License, or (at your option)
 * any later version.
 *
 * This library is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 */

package org.entando.entando.aps.system.services.dataobject;

import com.agiletec.aps.system.ApsSystemUtils;
import com.agiletec.aps.system.SystemConstants;
import com.agiletec.aps.system.common.entity.ApsEntityManager;
import com.agiletec.aps.system.common.entity.IEntityDAO;
import com.agiletec.aps.system.common.entity.IEntitySearcherDAO;
import com.agiletec.aps.system.common.entity.model.EntitySearchFilter;
import com.agiletec.aps.system.common.entity.model.IApsEntity;
import com.agiletec.aps.system.common.entity.model.SmallEntityType;
import com.agiletec.aps.system.exception.ApsSystemException;
import com.agiletec.aps.system.services.category.CategoryUtilizer;
import com.agiletec.aps.system.services.group.GroupUtilizer;
import com.agiletec.aps.system.services.keygenerator.IKeyGeneratorManager;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;
import org.entando.entando.aps.system.services.dataobject.event.PublicDataChangedEvent;
import org.entando.entando.aps.system.services.dataobject.model.DataObject;
import org.entando.entando.aps.system.services.dataobject.model.DataObjectRecordVO;
import org.entando.entando.aps.system.services.dataobject.model.SmallDataType;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * DataObjects manager. This implements all the methods needed to create and manage the DataObjects.
 *
 * @author M.Diana - E.Santoboni
 */
<span class="nc" id="L49">public class DataObjectManager extends ApsEntityManager implements IDataObjectManager, GroupUtilizer&lt;String&gt;, CategoryUtilizer {</span>

<span class="nc" id="L51">    private static final Logger logger = LoggerFactory.getLogger(DataObjectManager.class);</span>

    private IDataObjectDAO dataObjectDao;

    private IDataObjectSearcherDAO dataObjectSearcherDAO;

    private IDataObjectUpdaterService dataobjectUpdaterService;

    @Override
    protected String getConfigItemName() {
<span class="nc" id="L61">        return &quot;dataTypeDefinitions&quot;;</span>
    }

    /**
     * Create a new instance of the requested dataobject. The new dataobject is forked (or cloned) from the corresponding prototype, and
     * it's returned empty.
     *
     * @param typeCode The code of the requested (proto)type, as declared in the configuration.
     * @return The new dataobject.
     */
    @Override
    public DataObject createDataObject(String typeCode) {
<span class="nc" id="L73">        return (DataObject) super.getEntityPrototype(typeCode);</span>
    }

    /**
     * Return a list of the of the dataobject types in a 'small form'. 'Small form' mans that the dataobjects returned are purged from all
     * unnecessary information (eg. attributes).
     *
     * @return The list of the types in a (small form).
     * @deprecated From Entando 4.1.2, use getSmallEntityTypes() method
     */
    @Override
    public List&lt;SmallDataType&gt; getSmallDataTypes() {
<span class="nc" id="L85">        List&lt;SmallDataType&gt; smallDataObjectTypes = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L86">        smallDataObjectTypes.addAll(this.getSmallDataTypesMap().values());</span>
<span class="nc" id="L87">        Collections.sort(smallDataObjectTypes);</span>
<span class="nc" id="L88">        return smallDataObjectTypes;</span>
    }

    /**
     * Return the map of the prototypes of the dataobjects types. Return a map, index by the code of the type, of the prototypes of the
     * available dataobject types.
     *
     * @return The map of the prototypes of the dataobject types in a 'SmallDataObjectType' objects.
     */
    @Override
    public Map&lt;String, SmallDataType&gt; getSmallDataTypesMap() {
<span class="nc" id="L99">        Map&lt;String, SmallDataType&gt; smallDataTypes = new HashMap&lt;&gt;();</span>
<span class="nc" id="L100">        List&lt;SmallEntityType&gt; entityTypes = super.getSmallEntityTypes();</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">        for (SmallEntityType entityType : entityTypes) {</span>
<span class="nc" id="L102">            SmallDataType sdt = new SmallDataType();</span>
<span class="nc" id="L103">            sdt.setCode(entityType.getCode());</span>
<span class="nc" id="L104">            sdt.setDescription(entityType.getDescription());</span>
<span class="nc" id="L105">            smallDataTypes.put(entityType.getCode(), sdt);</span>
<span class="nc" id="L106">        }</span>
<span class="nc" id="L107">        return smallDataTypes;</span>
    }

    /**
     * Return the code of the default page used to display the given dataobject. The default page is defined at dataobject type level; the
     * type is extrapolated from the code built following the conventions.
     *
     * @param dataId The dataobject ID
     * @return The page code.
     */
    @Override
    public String getViewPage(String dataId) {
<span class="nc" id="L119">        DataObject type = this.getTypeById(dataId);</span>
<span class="nc" id="L120">        return type.getViewPage();</span>
    }

    /**
     * Return the code of the default model of dataobject.
     *
     * @param dataId The dataobject code
     * @return Il requested model code
     */
    @Override
    public String getDefaultModel(String dataId) {
<span class="nc" id="L131">        DataObject type = this.getTypeById(dataId);</span>
<span class="nc" id="L132">        return type.getDefaultModel();</span>
    }

    /**
     * Return the code of the model to be used when the dataobject is rendered in list
     *
     * @param dataId The code of the dataobject
     * @return The code of the model
     */
    @Override
    public String getListModel(String dataId) {
<span class="nc" id="L143">        DataObject type = this.getTypeById(dataId);</span>
<span class="nc" id="L144">        return type.getListModel();</span>
    }

    /**
     * Return a complete dataobject given its ID; it is possible to choose to return the published -unmodifiable!- dataobject or the working
     * copy. It also returns the data in the form of XML.
     *
     * @param id The ID of the dataobject
     * @param onLine Specifies the type of the dataobject to return: 'true' references the published dataobject, 'false' the freely
     * modifiable one.
     * @return The requested dataobject.
     * @throws ApsSystemException In case of error.
     */
    @Override
    public DataObject loadDataObject(String id, boolean onLine) throws ApsSystemException {
<span class="nc" id="L159">        return this.loadDataObject(id, onLine, false);</span>
    }

    @Override
    public DataObject loadDataObject(String id, boolean onLine, boolean cacheable) throws ApsSystemException {
<span class="nc" id="L164">        DataObject dataobject = null;</span>
        try {
<span class="nc" id="L166">            DataObjectRecordVO dataobjectVo = this.loadDataObjectVO(id);</span>
<span class="nc" id="L167">            dataobject = this.createDataObject(dataobjectVo, onLine);</span>
<span class="nc" id="L168">        } catch (ApsSystemException e) {</span>
<span class="nc" id="L169">            logger.error(&quot;Error while loading dataobject : id {}&quot;, id, e);</span>
<span class="nc" id="L170">            throw new ApsSystemException(&quot;Error while loading dataobject : id &quot; + id, e);</span>
<span class="nc" id="L171">        }</span>
<span class="nc" id="L172">        return dataobject;</span>
    }

    protected DataObject createDataObject(DataObjectRecordVO dataobjectVo, boolean onLine) throws ApsSystemException {
<span class="nc" id="L176">        DataObject dataobject = null;</span>
        try {
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (dataobjectVo != null) {</span>
                String xmlData;
<span class="nc bnc" id="L180" title="All 2 branches missed.">                if (onLine) {</span>
<span class="nc" id="L181">                    xmlData = dataobjectVo.getXmlOnLine();</span>
                } else {
<span class="nc" id="L183">                    xmlData = dataobjectVo.getXmlWork();</span>
                }
<span class="nc bnc" id="L185" title="All 2 branches missed.">                if (xmlData != null) {</span>
<span class="nc" id="L186">                    dataobject = (DataObject) this.createEntityFromXml(dataobjectVo.getTypeCode(), xmlData);</span>
<span class="nc" id="L187">                    dataobject.setId(dataobjectVo.getId());</span>
<span class="nc" id="L188">                    dataobject.setTypeCode(dataobjectVo.getTypeCode());</span>
<span class="nc" id="L189">                    dataobject.setDescription(dataobjectVo.getDescription());</span>
<span class="nc" id="L190">                    dataobject.setOnLine(dataobjectVo.isOnLine());</span>
<span class="nc" id="L191">                    dataobject.setMainGroup(dataobjectVo.getMainGroupCode());</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">                    if (null == dataobject.getVersion()) {</span>
<span class="nc" id="L193">                        dataobject.setVersion(dataobjectVo.getVersion());</span>
                    }
<span class="nc bnc" id="L195" title="All 2 branches missed.">                    if (null == dataobject.getFirstEditor()) {</span>
<span class="nc" id="L196">                        dataobject.setFirstEditor(dataobjectVo.getFirstEditor());</span>
                    }
<span class="nc bnc" id="L198" title="All 2 branches missed.">                    if (null == dataobject.getLastEditor()) {</span>
<span class="nc" id="L199">                        dataobject.setLastEditor(dataobjectVo.getLastEditor());</span>
                    }
<span class="nc bnc" id="L201" title="All 2 branches missed.">                    if (null == dataobject.getCreated()) {</span>
<span class="nc" id="L202">                        dataobject.setCreated(dataobjectVo.getCreate());</span>
                    }
<span class="nc bnc" id="L204" title="All 2 branches missed.">                    if (null == dataobject.getLastModified()) {</span>
<span class="nc" id="L205">                        dataobject.setLastModified(dataobjectVo.getModify());</span>
                    }
<span class="nc bnc" id="L207" title="All 2 branches missed.">                    if (null == dataobject.getStatus()) {</span>
<span class="nc" id="L208">                        dataobject.setStatus(dataobjectVo.getStatus());</span>
                    }
                }
            }
<span class="nc" id="L212">        } catch (ApsSystemException e) {</span>
<span class="nc" id="L213">            logger.error(&quot;Error while creating dataobject by vo&quot;, e);</span>
<span class="nc" id="L214">            throw new ApsSystemException(&quot;Error while creating dataobject by vo&quot;, e);</span>
<span class="nc" id="L215">        }</span>
<span class="nc" id="L216">        return dataobject;</span>
    }

    /**
     * Return a {@link DataObjectRecordVO} (shortly: VO) containing the all dataobject informations stored in the DB.
     *
     * @param id The id of the requested dataobject.
     * @return The VO object corresponding to the wanted dataobject.
     * @throws ApsSystemException in case of error.
     */
    @Override
    public DataObjectRecordVO loadDataObjectVO(String id) throws ApsSystemException {
<span class="nc" id="L228">        DataObjectRecordVO dataobjectVo = null;</span>
        try {
<span class="nc" id="L230">            dataobjectVo = (DataObjectRecordVO) this.getDataObjectDAO().loadEntityRecord(id);</span>
<span class="nc" id="L231">        } catch (Throwable t) {</span>
<span class="nc" id="L232">            logger.error(&quot;Error while loading dataobject vo : id {}&quot;, id, t);</span>
<span class="nc" id="L233">            throw new ApsSystemException(&quot;Error while loading dataobject vo : id &quot; + id, t);</span>
<span class="nc" id="L234">        }</span>
<span class="nc" id="L235">        return dataobjectVo;</span>
    }

    /**
     * Save a dataobject in the DB.
     *
     * @param dataobject The dataobject to add.
     * @throws ApsSystemException in case of error.
     */
    @Override
    public void saveDataObject(DataObject dataobject) throws ApsSystemException {
<span class="nc" id="L246">        this.addDataObject(dataobject);</span>
<span class="nc" id="L247">    }</span>

    @Override
    public void saveDataObjectAndContinue(DataObject dataobject) throws ApsSystemException {
<span class="nc" id="L251">        this.addUpdateDataObject(dataobject, false);</span>
<span class="nc" id="L252">    }</span>

    /**
     * Save a dataobject in the DB. Hopefully this method has no annotation attached
     */
    @Override
    public void addDataObject(DataObject dataobject) throws ApsSystemException {
<span class="nc" id="L259">        this.addUpdateDataObject(dataobject, true);</span>
<span class="nc" id="L260">    }</span>

    private void addUpdateDataObject(DataObject dataobject, boolean updateDate) throws ApsSystemException {
        try {
<span class="nc" id="L264">            dataobject.setLastModified(new Date());</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">            if (updateDate) {</span>
<span class="nc" id="L266">                dataobject.incrementVersion(false);</span>
            }
<span class="nc" id="L268">            String status = dataobject.getStatus();</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">            if (null == status) {</span>
<span class="nc" id="L270">                dataobject.setStatus(DataObject.STATUS_DRAFT);</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">            } else if (status.equals(DataObject.STATUS_PUBLIC)) {</span>
<span class="nc" id="L272">                dataobject.setStatus(DataObject.STATUS_READY);</span>
            }
<span class="nc bnc" id="L274" title="All 2 branches missed.">            if (null == dataobject.getId()) {</span>
<span class="nc" id="L275">                IKeyGeneratorManager keyGenerator = (IKeyGeneratorManager) this.getService(SystemConstants.KEY_GENERATOR_MANAGER);</span>
<span class="nc" id="L276">                int key = keyGenerator.getUniqueKeyCurrentValue();</span>
<span class="nc" id="L277">                String id = dataobject.getTypeCode() + key;</span>
<span class="nc" id="L278">                dataobject.setId(id);</span>
<span class="nc" id="L279">                this.getDataObjectDAO().addEntity(dataobject);</span>
<span class="nc" id="L280">            } else {</span>
<span class="nc" id="L281">                this.getDataObjectDAO().updateDataObject(dataobject, updateDate);</span>
            }
<span class="nc" id="L283">        } catch (Throwable t) {</span>
<span class="nc" id="L284">            logger.error(&quot;Error while saving dataobject&quot;, t);</span>
<span class="nc" id="L285">            throw new ApsSystemException(&quot;Error while saving dataobject&quot;, t);</span>
<span class="nc" id="L286">        }</span>
<span class="nc" id="L287">    }</span>

    /**
     * Publish a dataobject.
     *
     * @param dataobject The ID associated to the dataobject to be displayed in the portal.
     * @throws ApsSystemException in case of error.
     */
    @Override
    public void insertDataObject(DataObject dataobject) throws ApsSystemException {
        try {
<span class="nc" id="L298">            dataobject.setLastModified(new Date());</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">            if (null == dataobject.getId()) {</span>
<span class="nc" id="L300">                dataobject.setCreated(new Date());</span>
<span class="nc" id="L301">                this.saveDataObject(dataobject);</span>
            }
<span class="nc" id="L303">            dataobject.incrementVersion(true);</span>
<span class="nc" id="L304">            dataobject.setStatus(DataObject.STATUS_PUBLIC);</span>
<span class="nc" id="L305">            this.getDataObjectDAO().insertDataObject(dataobject);</span>
<span class="nc" id="L306">            int operationEventCode = -1;</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">            if (dataobject.isOnLine()) {</span>
<span class="nc" id="L308">                operationEventCode = PublicDataChangedEvent.UPDATE_OPERATION_CODE;</span>
            } else {
<span class="nc" id="L310">                operationEventCode = PublicDataChangedEvent.INSERT_OPERATION_CODE;</span>
            }
<span class="nc" id="L312">            this.notifyPublicDataObjectChanging(dataobject, operationEventCode);</span>
<span class="nc" id="L313">        } catch (Throwable t) {</span>
<span class="nc" id="L314">            logger.error(&quot;Error while inserting dataobject on line&quot;, t);</span>
<span class="nc" id="L315">            throw new ApsSystemException(&quot;Error while inserting dataobject on line&quot;, t);</span>
<span class="nc" id="L316">        }</span>
<span class="nc" id="L317">    }</span>

    @Override
    public void reloadEntityReferences(String entityId) {
        try {
<span class="nc" id="L322">            DataObjectRecordVO dataobjectVo = this.loadDataObjectVO(entityId);</span>
<span class="nc" id="L323">            DataObject dataobject = this.createDataObject(dataobjectVo, true);</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">            if (dataobject != null) {</span>
<span class="nc" id="L325">                this.getDataObjectDAO().reloadDataObjectReferences(dataobject);</span>
            }
<span class="nc" id="L327">            logger.debug(&quot;Reloaded dataobject references for dataobject {}&quot;, entityId);</span>
<span class="nc" id="L328">        } catch (Throwable t) {</span>
<span class="nc" id="L329">            logger.error(&quot;Error while reloading dataobject references for dataobject {}&quot;, entityId, t);</span>
<span class="nc" id="L330">        }</span>
<span class="nc" id="L331">    }</span>

    /**
     * Unpublish a dataobject, preventing it from being displayed in the portal. Obviously the dataobject itself is not deleted.
     *
     * @param dataobject the dataobject to unpublish.
     * @throws ApsSystemException in case of error
     */
    @Override
    public void removeDataObject(DataObject dataobject) throws ApsSystemException {
        try {
<span class="nc" id="L342">            dataobject.setLastModified(new Date());</span>
<span class="nc" id="L343">            dataobject.incrementVersion(false);</span>
<span class="nc bnc" id="L344" title="All 4 branches missed.">            if (null != dataobject.getStatus() &amp;&amp; dataobject.getStatus().equals(DataObject.STATUS_PUBLIC)) {</span>
<span class="nc" id="L345">                dataobject.setStatus(DataObject.STATUS_READY);</span>
            }
<span class="nc" id="L347">            this.getDataObjectDAO().removeDataObject(dataobject);</span>
<span class="nc" id="L348">            this.notifyPublicDataObjectChanging(dataobject, PublicDataChangedEvent.REMOVE_OPERATION_CODE);</span>
<span class="nc" id="L349">        } catch (Throwable t) {</span>
<span class="nc" id="L350">            logger.error(&quot;Error while removing onLine dataobject&quot;, t);</span>
<span class="nc" id="L351">            throw new ApsSystemException(&quot;Error while removing onLine dataobject&quot;, t);</span>
<span class="nc" id="L352">        }</span>
<span class="nc" id="L353">    }</span>

    /**
     * Notify the modification of a published dataobject.
     *
     * @param dataobject The modified dataobject.
     * @param operationCode the operation code to notify.
     * @throws ApsSystemException in caso of error.
     */
    private void notifyPublicDataObjectChanging(DataObject dataobject, int operationCode) throws ApsSystemException {
<span class="nc" id="L363">        PublicDataChangedEvent event = new PublicDataChangedEvent();</span>
<span class="nc" id="L364">        event.setDataObject(dataobject);</span>
<span class="nc" id="L365">        event.setOperationCode(operationCode);</span>
<span class="nc" id="L366">        this.notifyEvent(event);</span>
<span class="nc" id="L367">    }</span>

    /**
     * Return the dataobject type from the given ID code. The code is extracted following the coding conventions: the first three characters
     * are the type of the code.
     *
     * @param dataId the dataobject ID whose dataobject type is extracted.
     * @return The dataobject type requested
     */
    private DataObject getTypeById(String dataId) {
<span class="nc" id="L377">        String typeCode = dataId.substring(0, 3);</span>
<span class="nc" id="L378">        DataObject type = (DataObject) super.getEntityTypes().get(typeCode);</span>
<span class="nc" id="L379">        return type;</span>
    }

    /**
     * Deletes a dataobject from the DB.
     *
     * @param dataobject The dataobject to delete.
     * @throws ApsSystemException in case of error.
     */
    @Override
    public void deleteDataObject(DataObject dataobject) throws ApsSystemException {
        try {
<span class="nc" id="L391">            this.getDataObjectDAO().deleteEntity(dataobject.getId());</span>
<span class="nc" id="L392">        } catch (Throwable t) {</span>
<span class="nc" id="L393">            logger.error(&quot;Error while deleting dataobject {}&quot;, dataobject.getId(), t);</span>
<span class="nc" id="L394">            throw new ApsSystemException(&quot;Error while deleting dataobject &quot; + dataobject.getId(), t);</span>
<span class="nc" id="L395">        }</span>
<span class="nc" id="L396">    }</span>

    @Override
    public List&lt;String&gt; loadDataObjectsId(String dataobjectType, String[] categories, EntitySearchFilter[] filters,
            Collection&lt;String&gt; userGroupCodes) throws ApsSystemException {
<span class="nc" id="L401">        return this.loadDataObjectsId(dataobjectType, categories, false, filters, userGroupCodes);</span>
    }

    @Override
    public List&lt;String&gt; loadDataObjectsId(String dataobjectType, String[] categories, boolean orClauseCategoryFilter,
            EntitySearchFilter[] filters, Collection&lt;String&gt; userGroupCodes) throws ApsSystemException {
<span class="nc" id="L407">        List&lt;String&gt; dataobjectsId = null;</span>
        try {
<span class="nc" id="L409">            dataobjectsId = this.getDataObjectSearcherDAO()</span>
<span class="nc" id="L410">                    .loadDataObjectsId(dataobjectType, categories, orClauseCategoryFilter, filters, userGroupCodes);</span>
<span class="nc" id="L411">        } catch (Throwable t) {</span>
<span class="nc" id="L412">            logger.error(&quot;Error while loading dataobjects&quot;, t);</span>
<span class="nc" id="L413">            throw new ApsSystemException(&quot;Error while loading dataobjects&quot;, t);</span>
<span class="nc" id="L414">        }</span>
<span class="nc" id="L415">        return dataobjectsId;</span>
    }

    @Override
    public List&lt;String&gt; loadDataObjectsId(String[] categories,
            EntitySearchFilter[] filters, Collection&lt;String&gt; userGroupCodes) throws ApsSystemException {
<span class="nc" id="L421">        return this.loadDataObjectsId(categories, false, filters, userGroupCodes);</span>
    }

    @Override
    public List&lt;String&gt; loadDataObjectsId(String[] categories, boolean orClauseCategoryFilter,
            EntitySearchFilter[] filters, Collection&lt;String&gt; userGroupCodes) throws ApsSystemException {
<span class="nc" id="L427">        List&lt;String&gt; dataobjectsId = null;</span>
        try {
<span class="nc" id="L429">            dataobjectsId = this.getDataObjectSearcherDAO().loadDataObjectsId(categories, orClauseCategoryFilter, filters, userGroupCodes);</span>
<span class="nc" id="L430">        } catch (Throwable t) {</span>
<span class="nc" id="L431">            logger.error(&quot;Error while loading dataobjects&quot;, t);</span>
<span class="nc" id="L432">            throw new ApsSystemException(&quot;Error while loading dataobjects&quot;, t);</span>
<span class="nc" id="L433">        }</span>
<span class="nc" id="L434">        return dataobjectsId;</span>
    }

    @Override
    public List getCategoryUtilizers(String resourceId) throws ApsSystemException {
<span class="nc" id="L439">        List&lt;String&gt; dataIds = null;</span>
        try {
<span class="nc" id="L441">            dataIds = this.getDataObjectDAO().getCategoryUtilizers(resourceId);</span>
<span class="nc" id="L442">        } catch (Throwable t) {</span>
<span class="nc" id="L443">            throw new ApsSystemException(&quot;Error while loading referenced dataobjects : category &quot; + resourceId, t);</span>
<span class="nc" id="L444">        }</span>
<span class="nc" id="L445">        return dataIds;</span>
    }

    @Override
    public void reloadCategoryReferences(String categoryCode) {
        try {
<span class="nc" id="L451">            this.getDataObjectUpdaterService().reloadCategoryReferences(categoryCode);</span>
<span class="nc" id="L452">        } catch (Throwable t) {</span>
<span class="nc" id="L453">            ApsSystemUtils.logThrowable(t, this, &quot;reloadCategoryReferences&quot;);</span>
<span class="nc" id="L454">        }</span>
<span class="nc" id="L455">    }</span>

    @Override
    public List getCategoryUtilizersForReloadReferences(String categoryCode) {
<span class="nc" id="L459">        List&lt;String&gt; dataIdToReload = new ArrayList&lt;&gt;();</span>
        try {
<span class="nc" id="L461">            Set&lt;String&gt; dataobjects = this.getDataObjectUpdaterService().getDataObjectsId(categoryCode);</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">            if (null != dataobjects) {</span>
<span class="nc" id="L463">                dataIdToReload.addAll(dataobjects);</span>
            }
<span class="nc" id="L465">        } catch (Throwable t) {</span>
<span class="nc" id="L466">            ApsSystemUtils.logThrowable(t, this, &quot;getCategoryUtilizersForReloadReferences&quot;);</span>
<span class="nc" id="L467">        }</span>
<span class="nc" id="L468">        return dataIdToReload;</span>
    }

    @Override
    public List&lt;String&gt; getGroupUtilizers(String groupName) throws ApsSystemException {
<span class="nc" id="L473">        List&lt;String&gt; dataIds = null;</span>
        try {
<span class="nc" id="L475">            dataIds = this.getDataObjectDAO().getGroupUtilizers(groupName);</span>
<span class="nc" id="L476">        } catch (Throwable t) {</span>
<span class="nc" id="L477">            throw new ApsSystemException(&quot;Error while loading referenced dataobjects : group &quot; + groupName, t);</span>
<span class="nc" id="L478">        }</span>
<span class="nc" id="L479">        return dataIds;</span>
    }

    @Override
    public boolean isSearchEngineUser() {
<span class="nc" id="L484">        return true;</span>
    }

    @Override
    public DataObjectsStatus getDataObjectsStatus() {
<span class="nc" id="L489">        DataObjectsStatus status = null;</span>
        try {
<span class="nc" id="L491">            status = this.getDataObjectDAO().loadDataObjectsStatus();</span>
<span class="nc" id="L492">        } catch (Throwable t) {</span>
<span class="nc" id="L493">            logger.error(&quot;error in getDataObjectsStatus&quot;);</span>
<span class="nc" id="L494">        }</span>
<span class="nc" id="L495">        return status;</span>
    }

    /**
     * Return the DAO which handles all the operations on the dataobjects.
     *
     * @return The DAO managing the dataobjects.
     */
    protected IDataObjectDAO getDataObjectDAO() {
<span class="nc" id="L504">        return dataObjectDao;</span>
    }

    public void setDataObjectDAO(IDataObjectDAO dao) {
<span class="nc" id="L508">        this.dataObjectDao = dao;</span>
<span class="nc" id="L509">    }</span>

    @Override
    protected IEntitySearcherDAO getEntitySearcherDao() {
<span class="nc" id="L513">        return this.getDataObjectSearcherDAO();</span>
    }

    @Override
    protected IEntityDAO getEntityDao() {
<span class="nc" id="L518">        return this.getDataObjectDAO();</span>
    }

    public IDataObjectSearcherDAO getDataObjectSearcherDAO() {
<span class="nc" id="L522">        return dataObjectSearcherDAO;</span>
    }

    public void setDataObjectSearcherDAO(IDataObjectSearcherDAO dataObjectSearcherDAO) {
<span class="nc" id="L526">        this.dataObjectSearcherDAO = dataObjectSearcherDAO;</span>
<span class="nc" id="L527">    }</span>

    protected IDataObjectUpdaterService getDataObjectUpdaterService() {
<span class="nc" id="L530">        return dataobjectUpdaterService;</span>
    }

    public void setDataObjectUpdaterService(IDataObjectUpdaterService dataobjectUpdaterService) {
<span class="nc" id="L534">        this.dataobjectUpdaterService = dataobjectUpdaterService;</span>
<span class="nc" id="L535">    }</span>

    @Override
    public IApsEntity getEntity(String entityId) throws ApsSystemException {
<span class="nc" id="L539">        return this.loadDataObject(entityId, false);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>